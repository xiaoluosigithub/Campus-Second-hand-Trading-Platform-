## 问题定位
- 401：未登录时调用 `GET /api/users/me` 是预期行为，应在前端静默处理而不是抛错。
- 500：`POST http://localhost:5173/api/auth/login` 直打到 5173，说明代理未生效或配置有误，导致请求未正确转发到后端 8080。
- Dev overlay 显示 `[object Object]`：前端对错误对象没有规范化（未抛 `Error`），导致未处理的 Promise 拒绝被覆盖层捕获。

## 前端修改方案
### 1. 开启并校正代理
- 在前端开发服务器配置中启用代理：
  - 端口 `5173`
  - `proxy`：
    - `'/api' → http://localhost:8080`，`changeOrigin: true`
    - `'/uploads' → http://localhost:8080`，`changeOrigin: true`
- 目标：所有以 `/api`、`/uploads` 开头的请求都被转发到后端，并能透传/接收 Cookie。

### 2. Axios 实例对齐
- `baseURL: '/api'`
- `withCredentials: true`
- 请求拦截：非 `FormData` 设置 `Content-Type: application/json`；`FormData` 删除 `Content-Type`。
- 响应拦截：
  - 若有统一体：`code !== 200` → `Promise.reject(new Error(message))` 并携带 `err.code`。
  - 若无统一体但 `status === 401`：跳转 `/login?redirect=当前路径`，并不抛裸对象。
  - 其他网络错误：统一包装为可读文案的 `Error`；与 `ElMessage` 配合显示。

### 3. 路由守卫与会话恢复
- 进入任意路由如果 `userStore.initialized === false`，先 `getMe()`；对 401 静默处理（不弹错、不抛异常）。
- `requiresAuth`：未登录跳 `/login?redirect=to.fullPath`。
- `requiresAdmin`：未登录跳登录；已登录但 `role !== 'admin'` 返回首页并提示。

### 4. 登录与表单
- `POST /api/auth/login` 确认发送 JSON `{username, password}`。
- 登录成功后应看到响应体 `{code:200,data:{userId,nickname,role}}`，浏览器存入 `JSESSIONID`。

### 5. 验证步骤
- DevTools 网络面板检查：
  - 请求 URL 显示 `http://localhost:5173/api/...`，但 `Remote Address` 指向 `127.0.0.1:8080`（代理生效）。
  - 登录返回 200 且 `Set-Cookie: JSESSIONID` 存在；随后 `GET /api/users/me` 返回 200。
- 未登录访问 `/api/users/me` 返回 401 被前端静默，无 overlay。
- 图片访问 `GET /uploads/...` 正常（代理到后端）。

## 后端无需改动
- 后端上传路径问题已通过绝对路径与流拷贝修复，无需为当前 401/500 再做修改。当前问题主要在前端代理与错误处理。