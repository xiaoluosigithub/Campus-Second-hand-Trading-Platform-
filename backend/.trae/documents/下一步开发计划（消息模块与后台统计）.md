## 当前进度与差距

* 已实现：认证、商品（浏览/发布/编辑/上下架/我的）、购物车（增查删清理）、订单（下单/取消/发货/确认/我的订单）、后台审核与分类、管理员拦截。

* PRD差距：消息模块（留言板）未落地；后台订单统计与未读消息提醒接口未完善；支付模拟接口可选。

## M5：消息模块（留言板）

### 接口

* `GET /api/messages?contactId={id}&page&size`：获取与某人的对话记录（按 `created_at` 降序，分页）。

* `POST /api/messages`：发送消息（`receiverId`, `content`）。

* `GET /api/messages/contacts`：最近联系人列表（基于 messages 表聚合，返回对话对象及最后一条消息时间）。

* `GET /api/messages/unread/count`：未读消息数量（用于前端导航红点）。

* `POST /api/messages/{id}/read`：标记为已读（或批量按对话维度）。

### 规则与安全

* IDOR防护：仅会话参与双方可访问记录；发送禁止 `receiverId == currentUserId`；所有接口要求登录态。

* 分页与限制：`size≤50`；内容长度限制；基础防刷（简易限速中间件可选）。

### 文档与测试

* 文档：补充契约、请求/响应示例与错误码；curl 示例。

* 测试：会话分页、未授权访问拦截、发送参数校验、未读计数正确性。

## M6：后台订单统计与未读提醒

### 后台统计

* `GET /api/admin/stats/orders?date=YYYY-MM-DD`：返回当日订单数、成交额、状态分布（0/1/2/3）。

* `GET /api/admin/stats/top-categories?dateRange=...`：分类维度的销量/金额（可选）。

### 未读提醒（前端红点）

* `GET /api/messages/unread/count` 已在 M5；前端导航使用该接口显示红点。

### 文档与测试

* 文档：统计接口契约与示例；

* 测试：统计逻辑与边界（无数据/跨天）。

## M7：支付模拟与细节完善（可选）

* `POST /api/pay/mock`：根据订单ID返回“支付成功”，订单状态流入待发货（与现有下单流程对齐，或作为演示辅助）。

* 接入商品浏览量 `view_count` 自增（详情接口访问时递增，防抖）。

* 商品列表默认排序为 `newest`，已实现；可增加次排序为 `price`。

## 非功能与一致性

* 错误码统一（401/403/409/422/400）；分页默认与上限；中文提示友好一致。

* 日志合规与性能：关键业务 info；分页与筛选走索引；Messages 与 Orders 查询避免N+1。

* 安全：所有写接口做归属校验（IDOR）；管理员接口强制 `role=admin`。

## 交付与文档

* 每阶段更新 `document/接口文档.md` 与 `document/已实现功能.md`；提交 Postman/Apifox 用例集合。

* 验收标准：消息对话功能可用，未读红点返回正确，后台统计接口返回合理数据并通过测试。

## 起步任务（确认后立即执行）

* 实现消息模块全部接口与未读计数；更新文档与测试。

* 实现后台订单统计接口；更新文档与测试。

