# 开发进度（Vue3 + Element Plus + Axios）

## 项目概览
- 技术栈：Vue3、Vue Router、Pinia、Element Plus、Axios（基于 Session 会话）
- 参考文档：`document/项目流程.md`、`document/PRD.md`、`document/后端接口文档.md`

## 环境状态
- 前端开发服务器：`http://localhost:5173/`
- 代理：`/api` → `http://localhost:8080`（Cookie 透传，跨域凭证）
- 静态资源：`/uploads` → `http://localhost:8080`（头像/图片预览）
- Axios：`withCredentials: true`；非 FormData 请求设 `Content-Type: application/json`，上传自动生成分隔头

## 已完成
- 依赖安装：`vue-router@4`、`pinia`、`axios`、`element-plus`、`@element-plus/icons-vue`
- Element Plus 全局接入与中文本地化（`src/main.js`）
- 路由与视图骨架（`src/router/index.js`，视图占位于 `src/views/*`）
- 路由守卫：受保护与管理员路由、会话恢复（`src/router/index.js`）
- 基础布局组件：导航栏/页脚/返回顶部（`src/components/NavBar.vue`、`Footer.vue`、`BackToTop.vue`）
- 面包屑与分类接口：`src/components/Breadcrumbs.vue`、`src/api/categories.js`
- Pinia 接入与基础用户仓库（`src/stores/index.js`、`src/stores/user.js`）
- Axios 实例与统一拦截（`src/api/http.js`），响应 `{code,message,data}`；401 由路由守卫处理跳转（不再在拦截器中强制重定向）
- 开发代理与端口修正（`vue.config.js`：`port: 5173`，代理到 8080）
- 代码规范：Prettier 配置与 `npm run format`；ESLint 保持 Vue3 Essential，关闭单词组件名规则
- 预览运行成功：`http://localhost:5173/`

## 最近变更
- 调整前端端口到 5173，规避与后端 8080 冲突
- Axios 请求头策略优化：仅在非 FormData 时设置 `application/json`
- 修复 401 刷新循环：移除 Axios 强制跳转，改由路由守卫处理
- 新增基础布局：`NavBar/Footer/BackToTop`，导航栏联动登录态与未读消息红点
- 新增面包屑：接入 `GET /api/categories/{id}/path`（详情页占位渲染）
- 首页规则修正：主页仅展示“在售且无进行中订单”的商品（请求固定 `status=1`、`excludeActive=true`），移除状态筛选控件
- 视图文件重命名为多词：`HomePage.vue`、`LoginPage.vue`、`RegisterPage.vue`、`PublishPage.vue`、`PersonalCenter.vue`、`AdminPanel.vue`
- 发布商品页实现：表单（名称/价格/分类/图片/描述）与校验、分类级联、图片上传、提交创建并跳转详情/个人中心
- 个人中心实现：资料（头像上传与保存）、我的商品（筛选/编辑/上下架/取消发布/删除）、购物车（聚合/移除/清理）、我买到的（确认收货）、我卖出的（去发货）、我的消息（联系人/会话/发送/刷新）
- 头像上传限制与预览修复：限制单张上传（超限提示），并新增 `/uploads` 代理以确保上传后缩略图正常显示
- 购物车增强：新增选择列与合计、单品结算入口；结算前调用 `GET /api/orders/precheck` 并发校验（在售且无进行中订单）
- 错误处理规范化：Axios 拦截器统一 `Error` 对象（附 `code`），401 静默交由路由守卫处理，避免 Dev overlay 显示 `[object Object]`
- 订单确认页完善：拦截本人商品、提交前二次预校验、支付方式校验（仅 `alipay|wechat`）
- 购物车结算入口调整：预校验通过后统一跳转至订单确认页
- 开发覆盖层关闭：`devServer.client.overlay=false`，避免 ResizeObserver 警告弹窗干扰调试

## 进行中/下一步
-
- 留言消息未读联动增强与界面优化
- 管理后台界面与操作联动（审核/分类/用户/订单/统计）
- 跨页面体验与异常用例完善（空态/骨架屏/进度条）
- 打包部署与最终联调验收

## 接口契约与对齐
- 返回结构：统一按 `{code,message,data}` 处理；错误码对齐文档（200/400/401/409/422）
- 会话：基于服务端 Session，需携带 `JSESSIONID`；前端已启用 `withCredentials`
- 上传：表单 `file`，类型限制与大小限制由后端校验；前端通过 `FormData` 上报，拦截器不强设上传头
- 白名单：公开查询接口正常显示；受保护路由将基于登录态拦截；管理员路由校验 `role=admin`

## 验证状态
- 首页商品浏览完成：仅展示在售且无进行中订单商品；支持分类、关键词、排序；分页与空状态生效；卡片跳转详情
- 商品详情页完成：图片轮播、标题价格描述、状态与发布时间、卖家信息；加入购物车与立即购买预校验、聊一聊；面包屑接入
- 代理与 Cookie 透传已生效；登录页不再出现刷新循环
- 认证与用户态完成：注册/登录/登出、会话恢复与导航联动
- 发布商品完成：表单提交成功跳转详情或个人中心；上传接口401/500按后端文案提示
- 个人中心完成：资料保存与头像预览、我的商品各状态操作、购物车移除与清理、订单列表的发货/确认收货、消息发送与刷新
- 购物车验证完成：选择列与合计正常；单品结算前 `precheck` 校验通过方可进入后续流程，失效商品提示阻止
- 订单模块完成：订单确认页二次预校验与支付方式校验；创建订单后支付模拟；“我买到的/我卖出的”操作（取消/去发货/确认收货）与状态展示对齐接口
- 代理验证：`/api` 与 `/uploads` 代理到后端 8080 生效（Cookie 透传）；401 未登录与后端 500 不再触发未处理异常遮罩

## 关键路径索引
- 路由：`src/router/index.js`
- 入口：`src/main.js`；布局：`src/App.vue`
- 网络层：`src/api/http.js`
- 状态：`src/stores/index.js`、`src/stores/user.js`
- 视图：`src/views/HomePage.vue`、`LoginPage.vue`、`RegisterPage.vue`、`ProductDetail.vue`、`PublishPage.vue`、`PersonalCenter.vue`、`AdminPanel.vue`
- 布局组件：`src/components/NavBar.vue`、`Footer.vue`、`BackToTop.vue`、`Breadcrumbs.vue`
- 分类接口：`src/api/categories.js`
- 代理：`vue.config.js`

（此文档随模块推进持续更新）
