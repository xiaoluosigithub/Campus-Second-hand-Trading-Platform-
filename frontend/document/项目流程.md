## 项目初始化

1. 使用 Vite 创建 Vue3 项目，安装 `vue-router`、`pinia`、`axios`、`element-plus`。
2. 建立基础目录结构：`src/router`、`src/stores`、`src/api`、`src/views`、`src/components`、`src/assets`、`src/utils`。
3. 引入 Element Plus（全局样式、中文本地化），统一主题与基础排版。
4. 配置 ESLint/Prettier 与别名 `@`，确保统一代码风格。

## 网络层与会话

1. 创建 `axios` 实例：`baseURL` 指向后端，开启 `withCredentials: true`（后端基于 Session，依赖 `JSESSIONID` Cookie）。
2. 响应拦截：统一处理后端响应结构 `{code,message,data}`；`code !== 200` 走错误提示；`401` 跳登录。
3. 错误兜底：网络异常与超时统一提示；为可恢复的错误保留重试入口。
4. API 模块分层：`api/auth.ts`、`api/products.ts`、`api/cart.ts`、`api/orders.ts`、`api/admin.ts`、`api/messages.ts`、`api/users.ts`、`api/files.ts`，每个模块仅做接口映射。

## 路由与基础布局

1. 配置路由：`/login`、`/register`、`/`（首页）、`/products/:id`、`/publish`、`/me`（个人中心，内含子路由）、`/admin`（后台，内含子路由）。
2. 全局布局：顶部导航（Logo、登录态头像/昵称、未读消息红点、发布入口）、底部页脚、返回顶部按钮。
3. 路由守卫：受保护路由根据登录态拦截（参考接口白名单）；管理员路由根据 `role=admin` 限制。

## 认证与用户态

1. 登录页：表单校验、错误文案与接口对齐（账号不存在、密码错误、信息未填全）。
2. 注册页：密码一致性校验、账号已存在等错误提示。
3. Pinia 用户仓库：保存 `userId/nickname/role/avatarUrl`；提供 `login/logout/getMe`；刷新后从 `GET /api/users/me` 恢复；仅持久化非敏感信息。
4. 导航栏：根据登录态显示按钮或头像昵称；实现登出（`POST /api/auth/logout`）。

## 首页（商品浏览）

1. 商品卡片列表与分页；支持按类别、价格排序（`price_asc|price_desc`）、发布时间最新（`newest`）、关键字搜索。
2. 分类筛选：接入 `GET /api/categories/tree`；空态展示。
3. 列表查询对齐接口参数：`page/size/category/status/keyword/sort/excludeActive`。
4. 面包屑导航：落在详情页实现，首页保留入口跳转。

## 商品详情页

1. 展示商品信息与卖家信息；请求 `GET /api/products/{id}`（含浏览量递增）。
2. 操作栏：加入购物车、立即购买、聊一聊（跳转消息）。
3. 前置校验：禁止购买自己发布的商品；下单前执行 `GET /api/orders/precheck`。
4. 面包屑：接入 `GET /api/categories/{id}/path`，支持返回上一层。

## 发布商品

1. 表单：名称、价格、分类、图片上传、描述；提交到 `POST /api/products`，初始状态“待审核（0）”。
2. 图片上传：`POST /api/files/upload`，限制类型与大小；上传成功返回路径加入图片列表；预览与删除。
3. 取消发布：返回上一页或个人中心。

## 个人中心

1. 资料模块：编辑昵称、头像、签名（`PATCH /api/users/me/profile`）；获取个人资料（`GET /api/users/me`）。
2. 我的商品：卡片列表、按状态筛选（已售/在售/待审/驳回）与关键词搜索；分页。
3. 状态操作：

   * 待审核：禁用编辑；支持取消发布/删除（满足状态及无关联订单）。

   * 审核未通过：显示驳回原因；支持修改后重新提交（走编辑接口）；支持删除。

   * 在售：支持编辑（仅价格/描述）、下架（`PATCH /api/products/{id}/status`）。

   * 已下架：支持重新上架与删除（符合条件）。

   * 已售出：仅展示。
4. 商品编辑：`PUT /api/products/{id}`（仅价格/描述）。
5. 取消发布：`POST /api/products/{id}/cancel`（在售→下架；其他按删除流程）。
6. 删除商品：`DELETE /api/products/{id}`（校验关联订单与状态）。

## 购物车

1. 添加：`POST /api/cart`；待审核商品不可编辑（错误处理）。
2. 查询：`GET /api/cart/items?page&size` 聚合列表（标题/价格/状态/图片/加入时间），支持分页与空态；`size` 范围 1–50。
3. 移除与清理：`DELETE /api/cart/{productId}` 移除单品；`POST /api/cart/cleanup` 一键清除失效商品（非在售）。
4. 选择与结算：启用行选择（全选/反选），底部显示“已选 X 件，合计：￥Y”；结算入口仅支持单品结算（后端接口为单品订单），当多选时提示用户选择单件。
5. 并发校验：结算前调用 `GET /api/orders/precheck?productId=...`，仅在售且无进行中订单返回 `true`；失败提示“商品已失效或被抢光”，阻止进入确认页。

## 订单模块

1. 创建订单：`POST /api/orders`；校验支付方式（仅支付宝/微信）。
2. 取消订单：`POST /api/orders/{id}/cancel`（仅待发货）。
3. 卖家发货：`PATCH /api/orders/{id}/ship`（填写物流单号）。
4. 买家确认收货：`PATCH /api/orders/{id}/confirm`（成功后商品转“已售出（3）”）。
5. 我的订单：`GET /api/orders/me/bought`、`GET /api/orders/me/sold`；状态展示与操作按钮。
6. 订单确认/支付界面：从商品详情页点击“立即购买”进入；前置 `GET /api/orders/precheck` 校验在售且无进行中订单；确认页填写收件人、电话、地址、选择支付方式；提交创建订单后调用 `POST /api/pay/mock?orderId=...&method=...` 进行支付模拟并提示成功。

## 留言消息

1. 最近联系人：`GET /api/messages/contacts`（显示最近联系与时间）。
2. 会话记录：`GET /api/messages?contactId=...`（分页倒序）。
3. 发送消息：`POST /api/messages`；标记已读：`POST /api/messages/{id}/read`；未读计数：`GET /api/messages/unread/count`，在导航栏显示红点。
4. 手动刷新按钮与发送按钮，保证易用性。

## 后台管理（管理员）

1. 登录进入后台首页；右上角退出。
2. 商品审核：`PATCH /api/admin/products/{id}/review`，通过/驳回（驳回须填理由）。
3. 分类管理：列表 `GET /api/admin/categories`、新增 `POST`、删除 `DELETE`。
4. 用户管理：列表与搜索；修改角色 `PATCH /api/admin/users/{id}/role`；删除用户（有依赖时拦截）。
5. 订单列表与详情：`GET /api/admin/orders`、`GET /api/admin/orders/{id}`。
6. 订单统计：日统计与区间统计接口接入并图表化展示。

## 跨页面体验与细节

1. 返回顶部悬浮按钮；空状态插图与提示统一化组件。
2. 加载态与骨架屏；全局 `NProgress` 路由切换进度条。
3. 统一错误与成功提示；后端 `message` 文案直接展示。
4. 访问控制提示：未登录访问受保护页跳登录；`401` 自动重定向。
5. 性能：分页与按需加载组件；图片懒加载；避免一次性渲染过多卡片。

## 环境与代理

1. `.env`：区分开发/生产后端地址；确保 `axios` 指向正确 `baseURL`。
2. 本地开发代理：Vite 配置代理到 `http://localhost:8080`，开启 `changeOrigin` 与 Cookie 透传；保持 `withCredentials`。
3. 后端 CORS 与 Cookie：确认服务端允许跨域携带凭证与正确 `Set-Cookie` 域/路径。

## 验证与交付

1. 流程性验收用例覆盖所有主路径：注册→登录→发布→审核流转→浏览→购物车→下单→发货→确认→消息→后台管理。
2. 关键异常用例：401 未登录、参数越界（如 `size范围为1-50`）、资源冲突（注册账号存在）、支付方式不合法等。
3. 视觉与交互对齐 PRD 原型（导航、卡片、按钮文案）。

## 实施顺序（建议）

1. 项目初始化与网络层/路由/布局基础
2. 认证模块（登录/注册/登出，导航联动）
3. 首页商品列表与分类、搜索、排序、分页
4. 商品详情页与面包屑、操作栏
5. 发布商品与图片上传
6. 个人中心（资料与我的商品全套操作）
7. 购物车（列表、聚合、清理、结算校验）
8. 订单模块（创建/取消/发货/确认/我的订单）
9. 留言消息（联系人、记录、发送、未读）
10. 后台管理（审核、分类、用户、订单、统计）
11. 跨页面体验优化与异常用例完善
12. 环境与打包部署准备、最终联调与验收

## 成功标准

* 所有接口调用符合接口文档的参数与返回结构，错误码逻辑一致。

* 登录态基于 Session 正常维持，受保护路由与管理员权限严格生效。

* PRD 所有功能点可操作且有清晰的反馈与提示；空态、加载态与错误态完整。

